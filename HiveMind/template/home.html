<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Schedule maker</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
	<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
	<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet"
		href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css" />
	<link rel="stylesheet" href="./../static/css/mystyle.css" />
</head>

<body class="bg-light">
	<div class="container bg-light text-info">
		<h2>Available</h2>
		<div class="container">
			<table id="available" class="available table table-striped table-bordered table-sm" cellspacing="0" width="100%">

				<thead class="text-info">
					<tr>
						<th class="th-sm">Name
						</th>
						<th class="th-sm">Course Level
						</th>
						<th class="th-sm">Credits
						</th>
						<th class="table-fix" style="width: 1em;">
						</th>
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>
		</div>
		<h2>Not Available</h2>
		<div class="container">
			<table id="not-available" class="not-available table table-striped table-bordered table-sm" cellspacing="0"
				width="100%">
				<thead class="text-info">
					<tr>
						<th class="th-sm">Name
						</th>
						<th class="th-sm">Course Level
						</th>
						<th class="th-sm">Credits
						</th>
						<th class="table-fix" style="width: 1em;">
						</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<h2>Completed</h2>
		<div class="container">
			<table id="completed" class="not-available table table-striped table-bordered table-sm" cellspacing="0"
				width="100%">
				<thead class="text-info">
					<tr>
						<th class="th-sm">Name
						</th>
						<th class="th-sm">Course Level
						</th>
						<th class="th-sm">Credits
						</th>
						<th class="table-fix" style="width: 1em;">
						</th>
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>
		</div>
	</div>
	<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLongTitle"></h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<label class="mb-3 lead">Propose time and week day</label>
					<!-- Multiselect dropdown -->
					<select multiple data-style="bg-white rounded-pill px-4 py-3 shadow-sm " class="selectpicker w-100">
						<option>Monday</option>
						<option>Tuesday</option>
						<option>Wednesday</option>
						<option>Thursday</option>
						<option>Friday</option>
						<option>Saturday</option>
					</select><!-- End -->
					<label class="mb-3 lead" for="start-time" style="width: 5em;">Start time</label>
					<div style="display: inline-block; margin-top:1.5em;">
						<input id="start-time" class='timepicker' width="276" />
					</div>
					<br>
					<label class="mb-3 lead" for="end-time" style="width: 5em;">End time</label>
					<div style="display: inline-block; margin-top:1.5em;">
						<input id="end-time" class="timepicker" width="276" />
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button type="button" class="submit btn btn-primary" data-dismiss="modal">Submit</button>
				</div>
			</div>
		</div>
	</div>
	<div class="alert alert-success"
		style="width: 17em; position:fixed; right: 2.5em; bottom: 2.5em; padding-right: 0rem; display: none">
		<label for="alert-btn-success" style="display: block; user-select: none;">
			<button id="alert-btn-success" type="button" class="close" style="margin-right: 1em;"
				onclick="function alert_btn(){$('.alert-success').fadeOut( 'slow' )};alert_btn()">&times;</button>
			<strong>Success!</strong><br>Data submitted successfuly
		</label>
	</div>
	<div class="alert alert-danger alert-fail"
		style="width: 17em; position:fixed; right: 2.5em; bottom: 2.5em; padding-right: 0rem; display: none">
		<label for="alert-btn-fail" style="display: block; user-select: none;">
			<button id="alert-btn-fail" type="button" class="close" style="margin-right: 1em;"
				onclick="function alert_btn(){$('.alert-fail').fadeOut( 'slow' )};alert_btn()">&times;</button>
			<strong>Fail!</strong><br>Failed to submit data
		</label>
	</div>
	<!-- <script src="script.js" type="text/javascript"></script> -->
	<script>

		$(document).ready(function () {
			$('.selectpicker').selectpicker();
			$('#start-time').timepicker({
				uiLibrary: 'bootstrap4'
			});
			$('#end-time').timepicker({
				uiLibrary: 'bootstrap4'
			});
			var current_class = {
				_day: '',
				get weekDay() {
					return this._day;
				},
				set weekDay(dayString) {
					this._day = dayString
						.replace('Monday', 'M')
						.replace('Tuesday', 'T')
						.replace('Wednesday', 'W')
						.replace('Thursday', 'R')
						.replace('Friday', 'F')
						.replace('Saturday', 'S')
						.replace(/,\s/g, '')
						.replace('Nothing selected', 'MTWRFS');
				}
			}
			$('.submit')[0].addEventListener('click', (e) => {
				current_class.weekDay = $('.filter-option-inner-inner')[0].textContent;
				let startT = $('#start-time').timepicker('value')
				let endT = $('#end-time').timepicker('value')
				current_class.startTime = startT == "" ? "00:00:00" : startT + ":00";
				current_class.endTime = endT == "" ? "23:59:59" : endT + ":00";
				console.dir(current_class)
				$.post("/proposed/add", JSON.stringify({
					"StudentId": "b388e54c-e3e0-11e9-9d67-df57c5d8096b",
					"CourseId": current_class.id,
					"StartTime": current_class.startTime,
					"EndTime": current_class.endTime,
					"ProposedDays": current_class.weekDay
				}))
					.done(function (e) {
						console.log(e)
						$('.alert-success').fadeIn('slow')
						setTimeout(function () {
							$('.alert-success').fadeOut('slow')
						}, 2000)
					})
					.fail(function () {
						$('.alert-fail').fadeIn('slow')
						setTimeout(function () {
							$('.alert-fail').fadeOut('slow')
						}, 2000)
					})
			})
			function showPicker(event) {
				event.preventDefault();
				let title = $('h5.modal-title')[0]
				let id = event.target.parentNode.getAttribute("data-id");
				let name = event.target.parentNode.getAttribute("data-name");
				title.innerText = name;
				current_class.id = id;
			}
			$.post("/student", { studentId: "b388e54c-e3e0-11e9-9d67-df57c5d8096b" }).done(function (data) {
				console.log(data)
				$.each(data, function (key, value) {
					let fragment = new DocumentFragment()
					$.each(data[key], function (k, row) {
						let tr = document.createElement("TR");
						if (key == 'available') {
							tr.setAttribute("data-toggle", "modal");
							tr.setAttribute("data-target", "#exampleModalLong");
						}
						tr.setAttribute("data-id", row['CourseId']);
						tr.setAttribute("data-name", row['CourseName']);
						console.log(row['CourseId'])
						tr.addEventListener('click', showPicker)
						let td = document.createElement("TD");
						td.append(document.createTextNode(row['CourseName']));
						tr.append(td);
						fragment.append(tr);
						td = document.createElement("TD");
						td.append(document.createTextNode(row['CourseLevel']));
						tr.append(td);
						fragment.append(tr);
						td = document.createElement("TD");
						td.append(document.createTextNode(row['Credits']));
						tr.append(td);
						fragment.append(tr);
					});
					$('#' + key + ' tbody').append(fragment);
					if (document.getElementsByTagName('th')[0].offsetWidth != document.getElementsByTagName('td')[0].offsetWidth) $('th.table-fix').remove();
				});
			})
				.fail(function () {
					$('.alert-fail').fadeIn('slow')
					setTimeout(function () {
						$('.alert-fail').fadeOut('slow')
					}, 2000)
				}
				); /* end .getJSON */



		});
	</script>
</body>

</html>